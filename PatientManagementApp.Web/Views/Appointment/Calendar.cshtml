@{
    ViewBag.Title = "Calendar";
}
<h2 class="text-center">@ViewBag.Title</h2>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>

<div id="calendar"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl,
            {
                initialView: 'dayGridMonth',
                headerToolbar:
                {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: function(fetchInfo, successCallback, failureCallback) {
                    fetch('/Appointments/GetAppointments')
                        .then(response => response.json())
                        .then(events => {
                            console.log("Fetched events:", events); // Debugging to verify fetched events
                            successCallback(events); // Pass events to FullCalendar
                        })
                        .catch(error => {
                            console.error('Error fetching events:', error);
                            failureCallback(error);
                        });
                },

                eventClick: function(info) {
                    var appointmentId = info.event.id;
                    window.location.href = '/Appointments/Details/' + appointmentId; // Redirect to Details view
                }
            });

        try {
            calendar.render();
            console.log("Calendar rendered successfully");
        } catch (e) {
            console.error("Error rendering calendar:", e);
        }
    });
</script>
